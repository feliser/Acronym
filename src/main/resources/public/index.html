<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400"> -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <title>Acronym Generator</title>
  </head>
  <body>
    <div class="container-fluid text-center header-container">
      <div class="card header-card">
        <h1>Acronym Generator</h1>
      </div>
    </div>

    <div class="container-fluid text-center body-container">
      <div class="container text-center body-card-container">
        <div class="card body-card">
          <h1> Add Terms </h1>

          <form name="word-form" id="word-form" onsubmit="return validate();">
            <table class="table" id="dynamic-field">
              <tr>
                <td class="max-width">
                  <input type="text" name="word" id="word" class="form-control word_list" placeholder="Term">
                </td>

                <td>
                  <button type="button" class="btn orange-button" name="add" id="add">Add Row</button>
                </td>
              </tr>
            </table>

            <button type="button" class="btn orange-button" name="generate" id="generate"> Generate </button>
          </form>
        </div>
        <div class="card body-card" id="response-card">
          <h1>Best Suggestions</h1>
          <table class="table" id="response"></table>
        </div>
      </div>
    </div>
    
    <!-- jQuery, popper, bootstrap -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <script>
      var words = new Array();
      var request = '';

      function setCharAt(str,index,chr) {
        console.log(str + " " + index + " " + chr);
        if(index > str.length-1) return str;
        return str.substr(0,index) + chr.toUpperCase() + str.substr(index+1);
      }

      $(document).ready(function() {
        var rows = 1;
        $('#add').click(function() {
          rows++;
          $('#dynamic-field').append('<tr id="row'+rows+'"><td><input type="text" name="word" id="word" class="form-control word_list" placeholder="Term"></td><td><button type="button" class="btn btn_danger btn_remove" name="remove" id="'+rows+'">Remove</button></td></tr>');
        });
        $(document).on('click', '.btn_remove', function() {
          var button_id = $(this).attr("id");
          $("#row"+button_id+"").remove();
        });
        $('#generate').click(function() {
          document.getElementById("response").textContent = "";
          request = "";
          words = [];
          $("input").each(function(index) {
            if($(this).val() != "") {
              words.push($(this).val());
              request += $(this).val() + " ";
            }
          });          
          var wordsJSON = "{\"request\": " + JSON.stringify(words) + "}";
          var xmlhttp = new XMLHttpRequest();
		      xmlhttp.onreadystatechange = function() {
  		  	if (this.readyState == 4 && this.status == 200) {
          		var object = JSON.parse(this.responseText);
              $('#response-card').css('visibility', 'visible');
              var bold = document.createElement
              object.response.forEach(function (item, index) {
                var tr = document.createElement('tr');
                tr.appendChild( document.createElement('td') );
                tr.appendChild( document.createElement('td') );

                tr.cells[0].appendChild( document.createTextNode(item.word));
                tr.cells[0].appendChild( getBreakdown(item.boldIndices));

                var table = document.getElementById('response');
                table.appendChild(tr);
                console.log(item);
              });
          	}
		      };
		      xmlhttp.open("POST", "generate", true);
		      xmlhttp.setRequestHeader("Content-type", "application/json");
		      xmlhttp.send(wordsJSON);
        });
      });

      function getBreakdown(boldIndices) {
        var element = document.createElement('p');
        var response = request;
        boldIndices.forEach(function (item, index) {
          response = setCharAt(response, item + (7 * index), '<b>' + response.charAt(item + (7 * index)) + '</b>');
          console.log(response);
        });
        element.innerHTML = response;
        return element;
      }

    </script>
  </body>
</html>
